# .github/workflows/lint-and-format-check.yml
name: Lint & Format Check

on:
  push:
    branches:
      - main
  pull_request:
    branches: 
      - main

jobs:
  lint-and-prettier:
    name: ESLint & Prettier Check
    runs-on: ubuntu-latest

    steps:
      # 1) Checkout full history (for any potential Git-based rules)
      - name: Checkout code
        uses: actions/checkout@v4

      # 2) Install Node 20 & cache your npm downloads
      - name: Setup Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # 3) Recursively find every bots/** folder, install & run lint/format checks
      - name: Run ESLint & Prettier in each bot
        run: |
          failures=0
          for dir in $(find bots -type f -name package.json -exec dirname {} \; | sort -u); do
            echo ":mag: Checking $dir"
            pushd "$dir"

              echo ":arrow_right:  Installing dependencies"
              npm ci

              echo ":arrow_right:  Running ESLint"
              npm run lint

              echo ":arrow_right:  Checking Prettier formatting"
              npx prettier --check "**/*.{js,jsx,ts,tsx,css,md,json,yaml,yml}"

            popd || exit 1
          done